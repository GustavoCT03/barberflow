{% extends "base.html" %}
{% block title %}AdministraciÃ³n de la BarberÃ­a Â· BarberFlow{% endblock %}
{% block content %}
<section class="bf-section">
  <div class="bf-container bf-grid-2">
    <div class="bf-panel">
      <h2 class="bf-panel__title">Sucursales</h2>
      <a class="bf-btn" href="{% url 'sucursal_crear' %}">Crear sucursal</a>
      <ul class="bf-list">
        {% for s in sucursales %}
          <li class="bf-list__item">
            <div><strong>{{ s.nombre }}</strong> â€” {{ s.direccion }}</div>
            <div class="bf-list__actions">
              <a class="bf-link" href="{% url 'sucursal_editar' s.id %}">Editar</a>
              <a class="bf-link bf-link--danger" href="{% url 'sucursal_eliminar' s.id %}">Eliminar</a>
            </div>
          </li>
        {% empty %}
          <li class="bf-empty">Sin sucursales creadas.</li>
        {% endfor %}
      </ul>
    </div>

    <div class="bf-panel">
      <h2 class="bf-panel__title">Invitar barbero</h2>
      <a class="bf-btn bf-btn--primary" href="{% url 'barbero_crear' %}">
    Crear barbero manualmente
</a>
      <form class="bf-form" method="post" action="{% url 'crear_invitacion_barbero' %}">
        {% csrf_token %}
        <label>Correo del barbero</label>
        <input type="email" name="email" placeholder="barbero@ejemplo.com" required>
        <label>Sucursal</label>
        <select name="sucursal_id">
          {% for s in sucursales %}<option value="{{ s.id }}">{{ s.nombre }}</option>{% endfor %}
        </select>
        <button class="bf-btn" type="submit">Enviar invitaciÃ³n</button>
      </form>
      <p class="bf-muted">El barbero recibe un <strong>enlace firmado</strong> para registrarse directamente como barbero en esa sucursal.</p>
    </div>

    <div class="bf-panel">
      <h2 class="bf-panel__title">Servicios</h2>
      <a class="bf-btn" href="{% url 'servicio_list' %}">Ver todos los servicios</a>
      <a class="bf-btn" href="{% url 'servicio_crear' %}">Crear servicio</a>
      <ul class="bf-list">
        {% for srv in servicios %}
          <li class="bf-list__item">
            <div>{{ srv.nombre }} â€” {{ srv.duracion_minutos }} min Â· ${{ srv.precio }}</div>
            <div class="bf-list__actions">
              <a class="bf-link" href="{% url 'servicio_editar' srv.id %}">Editar</a>
              <a class="bf-link bf-link--danger" href="{% url 'servicio_eliminar' srv.id %}">Eliminar</a>
            </div>
          </li>
        {% empty %}
          <li class="bf-empty">Agrega tus servicios iniciales.</li>
        {% endfor %}
      </ul>
    </div>
    <div class="bf-panel">
  <h2 class="bf-panel__title">Citas</h2>
  <a class="bf-btn" href="{% url 'listar_citas_admin' %}">ðŸ“… Ver todas las citas</a>
  <p class="bf-muted" style="margin-top: 0.5rem;">
    Accede al panel completo de citas con filtros por <strong>fecha</strong> y <strong>barbero</strong>.
  </p>
</div>

    <div class="bf-panel">
      <h2 class="bf-panel__title">MÃ©tricas (Ãºltimos 7 dÃ­as)</h2>
      <ul class="bf-kpis">
        <li><span class="bf-kpi__num">{{ kpi.ocupacion|default:"0" }}%</span><span class="bf-kpi__desc">OcupaciÃ³n</span></li>
        <li><span class="bf-kpi__num">{{ kpi.no_shows|default:"0" }}</span><span class="bf-kpi__desc">No-shows</span></li>
        <li><span class="bf-kpi__num">{{ kpi.completadas|default:"0" }}/{{ kpi.total_citas|default:"0" }}</span><span class="bf-kpi__desc">Completadas</span></li>
        <li><span class="bf-kpi__num">{{ kpi.conversion_15|default:"0" }}%</span><span class="bf-kpi__desc">ConversiÃ³n 15â€²</span></li>
      </ul>
    </div>

    <div class="bf-panel">
      <h2 class="bf-panel__title">Reportes</h2>
      <a class="bf-btn" href="{% url 'metricas_barberos' %}">ðŸ“Š MÃ©tricas por Barbero</a>
      <a class="bf-btn" href="{% url 'estadisticas_ingresos' %}">ðŸ’° EstadÃ­sticas de Ingresos</a>
      <a class="bf-btn" href="{% url 'exportar_citas' %}">ðŸ“Š Exportar Citas CSV</a>
      <a class="bf-btn" href="{% url 'exportar_ingresos' %}">ðŸ’° Exportar Ingresos CSV</a>
      <form method="get" action="{% url 'exportar_citas' %}" style="margin-top: 1rem;">
        <label>Desde:</label>
        <input type="date" name="desde">
        <label>Hasta:</label>
        <input type="date" name="hasta">
        <button class="bf-btn" type="submit">Filtrar y Exportar</button>
      </form>
    </div>
  </div>
</section>
{% endblock %}